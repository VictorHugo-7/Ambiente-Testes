<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

<link rel="stylesheet" href="./galeriaVideos.css">

<!-- Link Ícones | https://cdnjs.com/libraries/font-awesome | https://fontawesome.com/ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

    
<a href="./loja.html">Loja</a>
<br>
<a href="./eventos.html">Eventos</a>
<a href="./galeriaVideos.html">Notícias</a>
<a href="./trabalhos.html">Trabalhos</a>
<a href="./galeriaFotos.html">Galeria Fotos</a>
<a href="./galeriaVideos.html">Galeria Vídeos</a>


<div class="container my-5">

    <!-- Divulgação - Galeria Videos -->
    <h5 class="my-divulgacao_galeriaVideos-s1-galeriaVideos mb-4">Galeria Vídeos</h5>

    <!-- Botões -->
    <div>
        <button type="button" class="btn btn-success" onclick="addCard()">Adicionar Card</button>
        <button type="button" class="btn btn-secondary" onclick="openEditModal()">Editar Card</button>
        <button type="button" class="btn btn-danger" onclick="openDeleteModal()">Excluir Card</button>
    </div>


    <!-- Card -->
    <div class="row mt-3" id="cards-container">
        <div class="col-12 col-md-6 col-lg-3 mb-4 card-wrapper">
            <div class="card" style="height: 100%;">
                <iframe class="my-divulgacao_galeriaVideos-s1-video card-video" width="100%" height="200"
                    src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="Video do trabalho" allowfullscreen></iframe>
                <div class="card-body">
                    <h5 class="card-title">Título</h5>
                    <p class="card-text text-muted card-description">Descrição</p>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                    <span class="my-divulgacao_galeriaVideos-s1-index">1</span>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Modal para exclusão -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Excluir Card</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="number" id="deleteIndex" class="form-control" placeholder="Índice do Card para excluir">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="deleteCard()">Excluir</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal para edição -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Editar Galeria Videos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <form id="editForm">
                    <!-- Índice -->
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fas fa-list-ol"></i></span>
                        <input type="number" class="form-control form-control-sm" id="editIndex"
                            placeholder="Índice Card">
                    </div>

                    <!-- URL do Vídeo -->
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fas fa-video"></i></span>
                        <input type="text" class="form-control form-control-sm" id="editVideo" placeholder="URL do Vídeo">
                    </div>

                    <!-- Título -->
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fas fa-heading"></i></span>
                        <input type="text" class="form-control form-control-sm" id="editTitle" placeholder="Título">
                    </div>

                    <!-- Descrição -->
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fas fa-align-left"></i></span>
                        <textarea class="form-control form-control-sm" id="editDescription"
                            placeholder="Descrição"></textarea>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="my-divulgacao_galeriaVideos-s1-btnSalvarAlterações" id="saveChangesBtn">Salvar
                    alterações</button>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
    crossorigin="anonymous"></script>


<script>
    let cardCount = 1; // Variável para contar o número total de cards

    // Função para adicionar um novo card
    function addCard() {
        const cardContainer = document.getElementById('cards-container');
        const newCard = document.createElement('div');
        newCard.classList.add('col-12', 'col-md-6', 'col-lg-3', 'mb-4', 'card-wrapper');

        // Card HTML com o índice correto atualizado
        newCard.innerHTML = `
            <div class="card" style="height: 100%;">
                <iframe class="my-divulgacao_galeriaVideos-s1-video card-video" width="100%" height="200"
                    src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="Video do trabalho" allowfullscreen></iframe>
                <div class="card-body">
                    <h5 class="card-title">Título</h5>
                    <p class="card-text text-muted card-description">Descrição</p>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                    <span class="my-divulgacao_galeriaVideos-s1-index">1</span>
                </div>
            </div>
            `;
        cardContainer.appendChild(newCard);
        cardCount++; // Incrementa o contador de cards
        updateCardIndices(); // Atualiza todos os índices após a adição
    }


    // Função para atualizar os índices visíveis nos cards
    function updateCardIndices() {
        const cards = document.querySelectorAll('.card-wrapper'); // Seleciona todos os cards
        cards.forEach((card, index) => {
            card.querySelector('.my-divulgacao_galeriaVideos-s1-index').textContent = index + 1;
        });
    }


    // Função para abrir o modal de exclusão
    function openDeleteModal() {
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        deleteModal.show();
    }


    // Função para excluir um card específico pelo índice
    function deleteCard() {
        const indexToDelete = parseInt(document.getElementById('deleteIndex').value, 10) - 1; // Converte o índice 1-based para 0-based
        const cards = document.querySelectorAll('.card-wrapper');

        if (indexToDelete >= 0 && indexToDelete < cards.length) {
            // Remove o card selecionado
            cards[indexToDelete].remove();

            // Decrementa o contador de cards para manter a contagem correta
            cardCount--;

            // Atualiza os índices visíveis dos cards
            updateCardIndices();

            // Fecha o modal de exclusão
            const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
            deleteModal.hide();
        } else {
            alert('Índice inválido. Por favor, escolha um índice de card válido.');
        }
    }

    // Função para abrir o modal de edição
    function openEditModal() {
        const editModal = new bootstrap.Modal(document.getElementById('editModal'));
        editModal.show();
    }

    // Função para salvar as alterações feitas no modal de edição
    document.getElementById('saveChangesBtn').addEventListener('click', function () {
        const editIndex = parseInt(document.getElementById('editIndex').value, 10) - 1;
        const videoUrl = document.getElementById('editVideo').value;
        const newTitle = document.getElementById('editTitle').value;
        const newDescription = document.getElementById('editDescription').value;
        
        // Função para transformar URLs do YouTube no formato embed
        function formatYouTubeUrl(url) {
            const youtubeRegex = /^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu.be\/)([\w-]{11})(?:[&?][\w-]+)*$/;
            const match = url.match(youtubeRegex);
            return match ? `https://www.youtube.com/embed/${match[1]}` : url;
        }

        // Verifique se a URL fornecida é do YouTube e formate-a
        const formattedVideoUrl = formatYouTubeUrl(videoUrl);

        const cards = document.querySelectorAll('.card-wrapper');
        if (editIndex >= 0 && editIndex < cards.length) {
            const card = cards[editIndex];
            card.querySelector('.card-video').src = formattedVideoUrl;
            card.querySelector('.card-title').textContent = newTitle;
            card.querySelector('.card-description').textContent = newDescription;

            const editModal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
            editModal.hide();
        } else {
            alert('Índice inválido. Por favor, escolha um índice de card válido.');
        }
    });
</script>
